<!DOCTYPE html>
<html lang="hu">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Kész dolgozatok feltöltése</title>
    <link rel="stylesheet" href="styles.css">
</head>
<body>
    <header>
        <h1>TDK Adminisztrációs Rendszer</h1>
        <nav>
            <ul>
                <li><a href="index.html">Főoldal</a></li>
                <li><a href="users.html">Felhasználók kezelése</a></li>
                <li class="dropdown">
                    <a href="#" class="dropbtn">Dolgozatok kezelése</a>
                    <div class="dropdown-content">
                        <a href="papers.html">Új dolgozatok hozzáadása</a>
                        <a href="completed-papers.html">Kész dolgozatok feltöltése</a>
                        <a href="review-papers.html">Dolgozatok értékelése</a>
                    </div>
                </li>
            </ul>
        </nav>
    </header>

    <main>
        <section>
            <h2>Kész dolgozatok feltöltése</h2>
            <table id="kesz-dolgozatok-table">
                <thead>
                    <tr>
                        <th>Cím</th>
                        <th>Hallgató ID</th>
                        <th>Témavezető ID</th>
                        <th>Állapot</th>
                        <th>Műveletek</th>
                    </tr>
                </thead>
                <tbody id="kesz-dolgozatok-tbody">
                    <!-- Kész dolgozatok listája ide kerül -->
                </tbody>
            </table>
        </section>
    </main>

    <script src="completed-papers.js"></script>
    <script>
        // Kész dolgozatok listázása
        async function listazKeszDolgozatok() {
            try {
                const response = await fetch('/api/dolgozatok/kesz');
                if (!response.ok) {
                    throw new Error('Network response was not ok');
                }
                const keszDolgozatok = await response.json();

                const keszDolgozatokTbody = document.getElementById('kesz-dolgozatok-tbody');
                keszDolgozatokTbody.innerHTML = '';
                keszDolgozatok.forEach(dolgozat => {
                    const row = document.createElement('tr');
                    row.innerHTML = `
                        <td>${dolgozat.cím}</td>
                        <td>${dolgozat.hallgato_id}</td>
                        <td>${dolgozat.temavezeto_id}</td>
                        <td>${dolgozat.allapot}</td>
                        <td>
                            <input type="file" id="file-${dolgozat._id}" required>
                            <button onclick="feltoltDolgozat('${dolgozat._id}')">Feltöltés</button>
                        </td>
                    `;
                    keszDolgozatokTbody.appendChild(row);
                });
            } catch (error) {
                console.error('Hiba történt a kész dolgozatok listázásakor:', error);
            }
        }

        async function feltoltDolgozat(dolgozatId) {
            const fileInput = document.getElementById(`file-${dolgozatId}`);
            const file = fileInput.files[0];

            if (!file) {
                alert('Kérlek, válassz ki egy fájlt a feltöltéshez!');
                return;
            }

            const formData = new FormData();
            formData.append('file', file);
            formData.append('dolgozatId', dolgozatId); // Az azonosító, hogy melyik dolgozathoz tartozik a fájl

            try {
                const response = await fetch('/api/dolgozatok/feltoltes', {
                    method: 'POST',
                    body: formData
                });
                if (!response.ok) {
                    throw new Error('Network response was not ok');
                }
                const result = await response.json();
                console .log('Dolgozat feltöltve:', result);
                // Itt frissítheted a táblázatot, ha szükséges
                listazKeszDolgozatok(); // Ezt a függvényt hívhatod, ha újra szeretnéd listázni a kész dolgozatokat
            } catch (error) {
                console.error('Hiba történt a dolgozat feltöltésekor:', error);
            }
        }

        // Kész dolgozatok listázása, amikor a oldal betöltődik
        listazKeszDolgozatok();
    </script>
</body>
</html>
